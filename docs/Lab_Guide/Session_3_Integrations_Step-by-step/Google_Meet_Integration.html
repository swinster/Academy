<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="../../css/bootstrap-4.4.1.css" rel="stylesheet" type="text/css">
    <link href="../../css/styles.css" rel="stylesheet" type="text/css" media="screen">
    <script src="../../js/jquery-3.4.1.min.js"></script>
    <script src="../../js/popper.min.js"></script>
    <script src="../../js/bootstrap-4.4.1.js"></script>
    <title>Google Meet Integration</title>
</head>

<body>
    <h1 id="header">Google Meet Integration</h1>
	<p>Suggested completion time: <strong>30 minutes</strong></p>
    <img src="../../images/Google_meet_logo.png" alt="image" width="100">
    <section>

        <!-- Trigger the modal with a button -->
        <div class="pad">
            <button type="button" class="btn btn-info openBtn">More info</button>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog modal-dialog-scrollable modal-xl" role="document">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">More information</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <p>Use <strong>section #5&nbsp;</strong>and <strong>section #11&nbsp;</strong>of the lab sheet.</p>
	<p>The Google Workspace interoperability feature has already been configured for you.</p>
    
    <section>
        

      <p>Adding the Google Meet tokens:</p>
        <ol>
            <li>Apply the license key from your lab sheet <strong>section #11</strong>.</li>
            <li>Navigate to <strong>Call</strong> <strong>Control&nbsp;</strong><strong>--&gt; Google Meet Access
                    Tokens.</strong></li>
            <li>Click ‚Äú<strong>Add Google Meet access token</strong>‚Äù and enter the name <strong>vcX-ghm-trusted</strong> (where X is your group number) and the trusted access token value from your lab sheet <strong>section #11</strong>, then click ‚Äú<strong>Save and add another</strong>‚Äù.</li>
            <li>Repeat the above process with the untrusted token (and an appropriate name) and click
                &ldquo;<strong>Save</strong>&rdquo;.</li>
        </ol>
        <p>&nbsp;</p>
        <p>Creating Call Routing for Google Meet Trusted devices:</p>
        <ol>
            <li>Navigate to <strong>Services</strong> <strong>--&gt; Call Routing</strong> and click
                &ldquo;<strong>Add Call Routing Rule</strong>&rdquo;.</li>
            <li>Configure the fields as described below (fields not mentioned are configurable per your choices):</li>
            <ol>
                <li>Name: Include the word &ldquo;<strong>Trusted</strong>&rdquo; so you can tell the rule apart from
                    the next rule you create.</li>
                <li>Select a priority that has not been used (e.g. 60) (<strong><u>be aware that more generic rules
                            might match first&hellip;</u></strong><u>)</u></li>
                <li>Apply to <strong>Incoming gateway calls</strong>.</li>
                <li>Enable &ldquo;<strong>Match incoming calls from registered devices only</strong>&rdquo;</li>
                <li><strong>Destination alias RegEx match</strong>: Use the example below, changed as needed for your
                    environment.</li>
                <p class="code">(&lt;google_prefix&gt;\d{3,9}|\d{13})($|(@&lt;your Pexip Infinity
                    domain&gt;$))<strong>&nbsp;&nbsp;</strong></p>
                <p>For example: <span class="code">(8\d{3,9}|\d{13})($|(@vc20-osl\.pexip\.net$))</span></p>
                <p>The above RegEx will match the Google prefix listed in <strong>section #11</strong> (in
                    this example <span class="code">8</span>), followed by 3-9 digits (which are randomly generated by
                    Google for the meeting code), then an <span class="code">@</span>&nbsp;symbol, then the domain name
                    of your group. It also will match on the 13-digit long meeting ID if used.</p>
                <p>An incoming call to <span class="code">81234@vc20-osl.pexip.net</span>&nbsp;would match, but <span
                        class="code">812@vc20-osl.pexip.net</span>,&nbsp;would not.</p>

                <li>Destination alias RegEx replace string: <span class="code">\1</span></li>
                <p>This refers to the first group in parentheses (i.e. the prefix plus the 3-9 digit short meeting meeting code, or the 13 digit long ID) which
                is what Pexip sends to Google to look up a valid meeting.</p>
                <li>Call target: <strong>Google Meet meeting</strong>.</li>
                <li>Outgoing Location: <strong>DMZ</strong></li>
                <li><strong>Access token:</strong> Choose your trusted token.</li>
                <li>Enable the &ldquo;<strong>Treat as trusted</strong>&rdquo; checkbox.</li>
            </ol>
        </ol>
        <p>&nbsp;</p>
        <p>Creating Call Routing for Google Meet Untrusted devices:</p>
        <ol>
            <li>Repeat the prior steps to create a second rule using your <u>un</u>trusted token, making appropriate
                adjustments to Name and Access token fields, and with the differences described below:<ol>
                    <li>Set a lower priority (higher number) than the rule above (e.g. 70) (<strong><u>also be aware
                                that other more generic rules might match
                                first&nbsp;</u></strong><strong><u>üòâ</u></strong>)</li>
                    <li>Ensure that &ldquo;<strong>Match incoming calls from registered devices only</strong>&rdquo; is
                        <u>disabled</u> (the default).</li>
                    <li>Use the same RegEx match and replace values.</li>
                    <li>Leave the &ldquo;<strong>Treat as trusted</strong>&rdquo; checkbox disabled.</li>
                </ol>
            </li>
        </ol>
        <hr>
        <p>&nbsp;</p>
    </section>
    <section>
      <h3 class="main">Testing</h3>

        <p>To test, navigate to <a class="general" href="https://meet.google.com/" target="_blank" title="Google Meet">https://meet.google.com</a>. You can start a new meeting, by clicking ‚Äú<strong>Start an  meeting</strong>‚Äù.</p>
        <p>Log in with your lab user
            credentials (see <strong>section #11</strong>). You will need to do this <strong>within the RDP session</strong> as
            otherwise, you will be prompted for a 2FA.</p>
        <p><img src="../../images/Google_meet_start_meeting.png" alt="image"><br>
        <p>If you are already logged in, you will see a "<strong>New Meeting</strong>" button, then; you can start a meeting by clicking ‚Äú<strong>Start an instant meeting</strong>‚Äù.</p>
        <img src="../../images/Google_meet_start_instant_meeting.png" alt="image"></p>
        <p>Once you are in the meeting, click the ‚Äú<strong>More phone number</strong>‚Äù link in
            the ‚Äú<strong>Your meeting is ready</strong>‚Äù box, then in the ‚Äú<strong>Third-party system</strong>‚Äù
            tab, you should see the joining options for your group.</p>
        <p>If you accidentily close this dialog, you can get to the same infomation by clicking the "<strong>i</strong>" button in the controll bar.</p>
        <p><img src="../../images/Google_meet_more_phone_numbers.png" alt="image"></p>
        <p><img src="../../images/Google_meet_third_party_systems.png" alt="image"></p>
        <p>Make sure you test both trusted and untrusted routes (so using both a registered endpoint and the WebApp or a
            SIP/MS-SIP client).</p>
        <p>In the real world, you probably would not want users to use the Infinity WebApp as they might as well
            navigate directly to Google Meet. Disabling any incoming call match for the &ldquo;Match Infinity Connect
            (WebRTC / RTMP)&rdquo; protocol <em>would</em> stop a WebApp user from gatewaying to Google Meet, but it
            would also stop users of the desktop Connect clients, as this is a Chromium app so still uses WebRTC.</p>
        <p>Google calendar invites will use the long meeting ID. Whilst One Touch Join can currently parse Google HTML
            pages using the short ID, it will likely use just the long ID going forward. These will be embedded in the
            calendar invite headers, providing a more scalable and robust joining option.</p>
        <hr>
        <p>&nbsp;</p>
    </section>
    <section>
        <h3 class="main">Screenshot 3: Demonstrate a Pexip Infinity system with a working Google Meet integration.</h3>

        <p>To ensure you have the Google integration working correctly, grab some screenshots of Live View that show the
            gateway calls in operation, using both the trusted and untrusted connection methods. You should be able to
            join the same Google Meet meeting for these different devices. Remember to drill down into the gateway call
            instance in Live View to show the participant graph, for example:</p>
        <p><strong>A screenshot of the main Live View for an untrusted Gateway instance to Google Meet:</strong></p>
        <p><img src="../../images/Liveview_Google_untrusted.png" alt="image"></p>
        <p><strong>A screenshot of the graph view of participants in an untrusted Gateway instance to Google
                Meet:</strong></p>
        <p><img src="../../images/Liveview_Google_untrusted_drilldown.png" alt="image"></p>
        <p><strong>A screenshot of the main Live View for a trusted Gateway instance to Google Meet:</strong></p>
        <p><img src="../../images/Liveview_Google_trusted.png" alt="image"></p>
        <p><strong>A screenshot of the graph view of participants in a trusted Gateway instance to Google Meet:</strong>
        </p>
        <p><img src="../../images/Liveview_Google_trusted_drilldown.png" alt="image"></p>
</section>
    
    <script>
        $('.openBtn').on('click', function () {
            $('.modal-body').load(
                '..//Session_3_Integrations_Description/Google_Meet_Integration.html',
                function () {
                    $('#myModal').modal({
                        show: true
                    });
                });
        });
    </script>
</body>

</html>