<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="../../css/bootstrap-4.4.1.css" rel="stylesheet" type="text/css">
    <link href="../../css/styles.css" rel="stylesheet" type="text/css" media="screen">
    <script src="../../js/jquery-3.4.1.min.js"></script>
    <script src="../../js/popper.min.js"></script>
    <script src="../../js/bootstrap-4.4.1.js"></script>
    <title>Extra Credit: Skype for Business Integration</title>
</head>

<body>
    <h1 id="header">Extra Credit: Skype for Business Integration</h1>
	<p>Suggested completion time: <strong>30 minutes</strong></p>
    <section>

        <!-- Trigger the modal with a button -->
        <div class="pad">
            <button type="button" class="btn btn-info openBtn">More info</button>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog modal-dialog-scrollable modal-xl" role="document">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">More information</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <p>Use <strong>section #2, section #4&nbsp;</strong>and <strong>section #6&nbsp;</strong>of the lab sheet.</p>
    <section>
        <h3 class="main">Setting up the integration</h3>
        
        <section>
        <p>
            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"> Button with data-target </button>
        </p>
        <div class="collapse" id="collapseExample">
            <div class="card card-body"> Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. 
            </div>
        </div>
        
        </section>

        
        <p>&nbsp;</p>
        <h4 class="main">Pexip Infinity configuration.</h4>
        <p>Add the Skype for Business server as a Lync/Skype for Business Server assign it to the Enterprise LAN
            location:
        </p>
        <ol>
            <li>Go to <strong>Call Control&nbsp;</strong><strong>--&gt; Lync/Skype for Business Servers</strong>.</li>
            <li>Click <strong>Add Lync/Skype for Business Server</strong>.</li>
            <li>Enter a name (this is just a display name).</li>
            <li>Enter the <strong>FQDN</strong> of the <strong>Skype for Business Server</strong> (lab sheet
                <strong>section
                    #6</strong>). This must be the FQDN, not an IP address, otherwise, certificate validation will fail.
            </li>
            <li>Leave other fields at default and click <strong>Save</strong>.</li>
        </ol>
        <p>&nbsp;</p>
        <p>Assign the Skype for Business server to the Enterprise LAN location:</p>
        <ol>
            <li>Go to <strong>Platform&nbsp;</strong><strong>--&gt; Locations</strong>.</li>
            <li>Click the <strong>Enterprise LAN</strong> location.</li>
            <li>Set the <strong>Lync/Skype for Business Server</strong> to be the new server you have just defined.</li>
            <li>Click <strong>Save</strong>.</li>
        </ol>
        <p>&nbsp;</p>
        <p>Ensure the Conferencing Nodes have the correct SIP TLS FQDNs configured.&nbsp;</p>
        <ol>
            <li>On <strong>Platform&nbsp;</strong><strong>--&gt; Conferencing Nodes</strong> click the first internal
                Pexip Conferencing Node.</li>
            <li>On the configuration value <strong>SIP TLS FQDN</strong>, add the FQDN of the Conferencing Node (lab
                sheet
                <strong>section #4.1</strong>) and click <strong>Save</strong>.<ol>
                    <li>Repeat on the second Conferencing Node with its FQDN.</li>
                </ol>
            </li>
            <li>Make sure that the correct certificate is assigned on the internal Pexip Conferencing Nodes.</li>
        </ol>
        <p>&nbsp;</p>
        <p>Configure the global Pexip Infinity domain:</p>
        <ol>
            <li>On <strong>Platform&nbsp;</strong><strong>--&gt; Global Settings.</strong></li>
            <li><strong>Pexip Infinity domain (for Lync/Skype for Business integration):</strong> fill in the domain
                that is
                used by Pexip. You can find this on the lab sheet <strong>section #4.2</strong> as &ldquo;<strong>Pexip
                    Infinity domain</strong>&rdquo; (<strong>note:&nbsp;</strong>this is NOT the Skype for Business SIP
                domain).</li>
            <li>Click <strong>Save</strong>.</li>
        </ol>
        <p>&nbsp;</p>

        <h4 class="main">Testing Initial Skype for Business integration</h4>

        <p>Your trainer should have a Skype for Business client logged in to the OnPrem Skype for Business deployment.
            Ask
            your trainer to dial into a VMR you recently created.</p>
        <hr>

        <p>&nbsp;</p>
    </section>
    <section>
      <h3 class="main">Joining a Skype for Business meeting&nbsp;using Call Routing</h3>

        <p>Use<strong>&nbsp;section #4.2&nbsp;</strong>and <strong>section #6</strong> of the lab sheet.</p>

        <h4 class="main">Direct dialling into a Skype for Business Meeting</h4>

        <p>Joining an SfB meeting using direct dialling to the Conference ID:</p>
        <ol>
            <li>Go to <strong>Services&nbsp;</strong>--&gt;<strong>&nbsp;Call Routing&nbsp;</strong>and click
                <strong>Add
                    Call Routing Rule</strong>.</li>
            <li>Configure a matching <strong>name</strong> and <strong>priority</strong>.</li>
            <li><strong>Match</strong> only <strong>incoming</strong> gateway calls and any location.</li>
            <li><strong>Match SIP/H.323</strong> and <strong>WebRTC</strong> to support Infinity Connect.
                <strong>Uncheck
                    Lync/Skype for Business</strong> &ndash; it is unnecessary because SfB client users will connect
                directly to SfB using the Skype meeting link.</li>
            <li><strong>Destination alias RegEx</strong> <strong>match:&nbsp;</strong>Match incoming call on
                <span class="code">sfb.(\d{5,6})@&lt;your Pexip Infinity domain&gt;&nbsp;</span>You can find the domain
                of your group in the lab sheet
                <strong>section #4.2</strong>.<ol>
                    <li>The rule will match any dial-string where the host part (before the &lsquo;@&rsquo; sign) is
                        either
                        5 or 6 digits.</li>
                </ol>
            </li>
            <li>In the <strong>replace string</strong>, configure <span class="code">\1</span>&nbsp;which means that the
                rule will provide only the
                digits when passing the call to the SfB server &ndash; effectively stripping your group&rsquo;s domain
                and
                sending only what SfB needs.<ol>
                    <li>The <span class="code">\1</span>&nbsp;references the <span class="code">(
                            &nbsp;)</span>&nbsp;parenthesis sequence, so this returns the result from the
                        first set.</li>
                </ol>
            </li>
            <li><strong>Call target:</strong> <strong>Lync/Skype for Business meeting direct (Conference ID in dialled
                    alias)</strong>.</li>
            <li><strong>Outgoing location: Enterprise LAN</strong>.</li>
            <li>Select the <strong>Lync/Skype for Business Server</strong> you configured previously.</li>
            <li><strong>Save</strong>.</li>
        </ol>
        <p>&nbsp;</p>

        <h4 class="main">Indirect dialling (via a Lobby) into a Skype for Business Meeting</h4>

        <p>Create the virtual reception (lobby):</p>
        <ol>
            <li>Go to <strong>Services&nbsp;</strong><strong>--&gt; Virtual Reception</strong> and click <strong>Add
                    Virtual Reception</strong>.</li>
            <li>Give the Virtual Reception a <strong>name</strong>.</li>
            <li>Chose a Virtual Reception type of <strong>Lync/Skype for Business</strong>.</li>
            <li>Select the <strong>SfB server&nbsp;</strong>and <strong>lookup location</strong>, then select the
                internal
                location <strong>Enterprise LAN</strong>.</li>
            <li>Give the Virtual Reception an alias like <strong class="code">skype@&lt;your lab group
                    domain&gt;</strong> which can be
                found in the lab sheet in <strong>section #4.2</strong></li>
            <li><strong>Save</strong>.</li>
        </ol>
        <p>&nbsp;</p>
        <p>Create the call routing rule:</p>
        <ol>
            <li>Go to <strong>Services&nbsp;</strong><strong>--&gt; Call Routing Rules</strong> and click <strong>Add
                    Call
                    Routing Rule</strong>.</li>
            <li>Configure a <strong>name</strong> and priority (we recommend a lower priority (higher number) like 150
                since
                this rule will have a more general matching scope).</li>
            <li>Match <strong>only incoming gateway calls</strong> and in <strong>any location</strong>.</li>
            <li>Match incoming<strong>&nbsp;SIP/H.323</strong> and <strong>WebRTC</strong> to support Infinity connect.
                <strong>Uncheck Lync/Skype for Business</strong> because SfB users will connect using the Skype meeting
                link.</li>
            <li><strong>Check</strong> match against <strong>full alias URI</strong>.</li>
            <li><strong>Match</strong> incoming call on:<br><strong>
                    &nbsp;</strong><span class="code">.+@&lt;the domain of the SfB environment&gt;.*</span><br>&nbsp;You
                can find the domain on
                the lab sheet <strong>section #6</strong> (<strong>Note:</strong> this is the</li>
            <li>, not the FQDN of the front-end server or pool. Also note that the <span class="code">.*</span> is very
                important &ndash;
                <strong><u>Why?</u></strong>)</li>
            <li>On the <strong>replace string</strong>, leave the field <strong>blank</strong> as no rewriting or
                transformation is necessary for this rule.</li>
            <li><strong>Call target: Lync/Skype for Business clients, or meetings via a virtual reception</strong>.</li>
            <li><strong>Outgoing location: Enterprise LAN</strong>.</li>
            <li>Select the <strong>Lync/Skype for Business Server</strong>.</li>
            <li><strong>Save</strong>.</li>
        </ol>
        <p>&nbsp;</p>

        <h4 class="main">Testing joining a Skype for Business meeting</h4>

        <p>Ask your trainer to create a Skype meeting and provide the <strong>conference ID</strong>. Use WebRTC, or any
            video endpoint to connect to the virtual reception you created and then use DTMF tones to enter the
            conference
            ID.</p>
        <hr>

        <p>&nbsp;</p>
    </section>
    <section>
        <h3 class="main">An additional routing rule for Skype For Business</h3>

        <p>No specific lab sheet section.</p>
        <p>Time to think for yourselves, so there are no step-by-step instructions for this section. See the
            description&nbsp;<strong>Error! Bookmark not defined.</strong> to complete this step.&nbsp;</p>
        <p>&nbsp;</p>

        <h4 class="main">Testing the addition routing rule for Skype for Business</h4>

        <p>Your trainer should have an SfB client open which you can dial from any device.</p>
        <p>Make sure you don&rsquo;t break anything else!</p>
        <p>What is the difference between this rule and the SfB rule used for the indirect routing via the Skype VR
            (which
            seems to already work for web app users only)?</p>
        <p>&nbsp;</p>
    </section>
    
<!--    <script>
        var coll = document.getElementsByClassName("collapsible");
        var i;
        
        for (i = 0; i < coll.length; i++) {
          coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
              content.style.maxHeight = null;
            } else {
              content.style.maxHeight = content.scrollHeight + "px";
            }
          });
        }
    </script>-->
    
    <script>
        $('.openBtn').on('click', function () {
            $('.modal-body').load(
                '..//Session_3_Integrations_Description/Extra_Credit-Skype_for_Business_Integration.html',
                function () {
                    $('#myModal').modal({
                        show: true
                    });
                });
        });
    </script>
</body>

</html>